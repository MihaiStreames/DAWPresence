name: Build Release

on:
    push:
        tags:
            - 'v*'
    workflow_dispatch:

jobs:
    build:
        runs-on: windows-latest

        steps:
            -   uses: actions/checkout@v4

            -   name: Set up Python
                uses: actions/setup-python@v4
                with:
                    python-version: '3.11'

            -   name: Install dependencies
                run: |
                    pip install pyinstaller
                    pip install -r DAWPY/requirements.txt

            -   name: Build executable
                run: |
                    cd DAWPY
                    pyinstaller DAWPresence.spec

            -   name: Upload artifact
                uses: actions/upload-artifact@v4
                with:
                    name: DAWPresence-Windows
                    path: DAWPY/dist/DAWPresence.exe

            -   name: Create Release
                if: startsWith(github.ref, 'refs/tags/')
                uses: softprops/action-gh-release@v1
                with:
                    files: DAWPY/dist/DAWPresence.exe
                    draft: false
                    prerelease: false
                env:
                    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}